<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>My Results - Learn Mate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link th:href="@{/css/main.css}" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">
    <header class="bg-blue-600 text-white p-4 flex justify-between items-center shadow-md">
        <h1 class="text-2xl font-bold">Learn Mate</h1>
        <nav>
            <a th:href="@{/dashboard}" class="mx-2 hover:underline">Dashboard</a>
            <a th:href="@{/logout}" class="mx-2 hover:underline">Logout</a>
        </nav>
    </header>
    <div class="flex">
        <div th:replace="~{fragments/sidebar :: modern-sidebar('marks')}"></div>
        
        <main class="flex-1 p-6">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-blue-600 mb-2">My Results</h2>
                    <p class="text-gray-600">View your exam results and feedback from teachers.</p>
                </div>
                
                <!-- Error Messages -->
                <div th:if="${error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4" role="alert">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                        </svg>
                        <span th:text="${error}"></span>
                    </div>
                </div>
                
                <!-- Student Info -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                    <h3 class="text-lg font-semibold text-blue-800 mb-2">Student Information</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="font-medium text-blue-700">Name:</span>
                            <span th:text="${student.name}" class="ml-2 text-blue-600"></span>
                        </div>
                        <div>
                            <span class="font-medium text-blue-700">Class:</span>
                            <span th:text="${student.schoolClass != null ? student.schoolClass.name : 'N/A'}" class="ml-2 text-blue-600"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Results Table -->
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse bg-white shadow-sm rounded-lg overflow-hidden">
                        <thead>
                            <tr class="bg-blue-50 border-b border-blue-100">
                                <th class="p-4 text-left font-semibold text-blue-900">Subject</th>
                                <th class="p-4 text-left font-semibold text-blue-900">Exam Date</th>
                                <th class="p-4 text-left font-semibold text-blue-900">Max Marks</th>
                                <th class="p-4 text-left font-semibold text-blue-900">Your Score</th>
                                <th class="p-4 text-left font-semibold text-blue-900">Grade</th>
                                <th class="p-4 text-left font-semibold text-blue-900">Status</th>
                                <th class="p-4 text-left font-semibold text-blue-900">Comments</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="mark : ${marks}" class="border-b border-gray-100 hover:bg-gray-50 transition">
                                <td class="p-4">
                                    <div class="font-medium" th:text="${mark.exam.subject.name}">Mathematics</div>
                                </td>
                                <td class="p-4">
                                    <span th:text="${mark.exam.date != null ? #temporals.format(mark.exam.date, 'dd MMM yyyy') : 'N/A'}">25 Dec 2025</span>
                                </td>
                                <td class="p-4">
                                    <span th:text="${mark.exam.maxMarks}">100</span>
                                </td>
                                <td class="p-4">
                                    <span class="font-semibold text-lg" th:text="${mark.score}">85</span>
                                </td>
                                <td class="p-4">
                                    <span th:if="${mark.exam.passMark != null and mark.score >= mark.exam.passMark}" 
                                          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        Pass
                                    </span>
                                    <span th:if="${mark.exam.passMark != null and mark.score < mark.exam.passMark}" 
                                          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                        Fail
                                    </span>
                                    <span th:if="${mark.exam.passMark == null}" class="text-gray-500 text-sm">-</span>
                                </td>
                                <td class="p-4">
                                    <span th:if="${mark.published}" 
                                          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        Published
                                    </span>
                                    <span th:if="${!mark.published}" 
                                          class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                        Not Published
                                    </span>
                                </td>
                                <td class="p-4">
                                    <span th:if="${mark.comments != null and !mark.comments.isEmpty()}" 
                                          class="text-sm text-gray-600" th:text="${mark.comments}">Good work!</span>
                                    <span th:if="${mark.comments == null or mark.comments.isEmpty()}" 
                                          class="text-gray-400 text-sm italic">No comments</span>
                                </td>
                            </tr>
                            <tr th:if="${#lists.isEmpty(marks)}">
                                <td colspan="7" class="p-8 text-center text-gray-500">
                                    <div class="text-gray-400 text-lg mb-2">No results found</div>
                                    <p class="text-gray-400">You don't have any exam results yet. Results will appear here once your teachers grade your exams.</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <!-- Summary Stats -->
                <div th:if="${!#lists.isEmpty(marks)}" class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-sm font-medium text-blue-700">Total Exams</div>
                        <div class="text-2xl font-bold text-blue-900" th:text="${#lists.size(marks)}">0</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <div class="text-sm font-medium text-green-700">Passed Exams</div>
                        <div class="text-2xl font-bold text-green-900" 
                             th:text="${#lists.size(marks.stream().filter(m -> m.exam.passMark != null and m.score >= m.exam.passMark).toList())}">0</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <div class="text-sm font-medium text-purple-700">Average Score</div>
                        <div class="text-2xl font-bold text-purple-900" 
                             th:text="${#numbers.formatDecimal(marks.stream().mapToInt(m -> m.score).average().orElse(0.0), 1, 1)}">0.0</div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
